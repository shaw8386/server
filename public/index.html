<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Káº¿t Quáº£ Xá»• Sá»‘ â€” GI8 Mobile</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* áº¨n cÃ¡c trang chÆ°a active */
    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>
<body>
<div class="wrap">
  <!-- ======= TOPBAR ======= -->
  <div class="topbar">
    <div class="menu-btn" id="menuBtn">â˜°</div>
    <div class="title" id="pageTitle">Trang Chá»§</div>
    <div class="more-btn" id="authBtn">ğŸ”</div>
    <div class="more-btn" id="calendarBtn" style="display:none;">ğŸ“…</div>
  </div>

  <!-- ======= SIDEBAR MENU ======= -->
  <div id="sidebar">
    <div class="sidebar-header">ğŸ“‹ Menu</div>
    <div class="sidebar-item" data-page="home">ğŸ  Trang Chá»§</div>
    <div class="sidebar-item" data-page="profile">ğŸ‘¤ ThÃ´ng tin cÃ¡ nhÃ¢n</div>
    <div class="sidebar-item" data-page="lottery">ğŸ¯ Káº¿t Quáº£ XS</div>
    <div class="sidebar-item" data-page="tickets">ğŸŸï¸ DÃ² VÃ© Sá»‘ Tá»± Äá»™ng</div>
    <div class="sidebar-item" data-page="lives">ğŸ¥ Trá»±c Tiáº¿p KQXS</div>
  </div>

  <!-- ======= TRANG CHá»¦ ======= -->
  <div id="page-home" class="page active">
    <div class="home-guide">

      <h2 style="margin-bottom:10px;">ğŸ“– HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng</h2>

      <div class="guide-item" onclick="switchPage('lottery')">
        ğŸ† <b>Xem Káº¿t Quáº£ Xá»• Sá»‘</b>
        <div class="desc">Xem káº¿t quáº£ tá»«ng ngÃ y, theo Miá»n & ÄÃ i.</div>
      </div>

      <div class="guide-item" onclick="switchPage('tickets')">
        ğŸ” <b>Tra Cá»©u VÃ© Tá»± Äá»™ng</b>
        <div class="desc">Nháº­p vÃ© â†’ lÆ°u láº¡i â†’ tá»± Ä‘á»™ng dÃ² khi cÃ³ káº¿t quáº£.</div>
      </div>

      <div class="guide-item" onclick="switchPage('lives')">
        ğŸ¥ <b>Trá»±c Tiáº¿p Quay Sá»‘</b>
        <div class="desc">Xem quay sá»‘ theo thá»i gian thá»±c (Äang phÃ¡t triá»ƒn).</div>
      </div>

      <div class="guide-item">
        ğŸ”” <b>ThÃ´ng BÃ¡o Káº¿t Quáº£</b>
        <div class="desc">á»¨ng dá»¥ng sáº½ gá»­i thÃ´ng bÃ¡o khi cÃ³ káº¿t quáº£ má»›i.</div>
      </div>

    </div>

  </div>

  <!-- ======= THÃ”NG TIN CÃ NHÃ‚N ======= -->
  <div id="page-profile" class="page">
    <div class="card profile-card">
      <div class="profile-title">ğŸ‘¤ ThÃ´ng tin cÃ¡ nhÃ¢n</div>

      <!-- ===== LOGGED OUT ===== -->
      <div id="authStateLoggedOut" class="auth-logged-out">
        <div id="authMsg" class="auth-msg" style="display:none;"></div>

        <div class="login-form">
          <div class="login-title">ÄÄƒng nháº­p</div>

          <input id="loginUsername" type="tel" inputmode="numeric" placeholder="Username (Telegram ID)">
          <input id="loginPassword" type="password" placeholder="Password">

          <button id="btnLogin" class="ticket-submit-btn">
            <span class="btn-login-inline">
              <svg class="icon-lock" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M17 8h-1V6a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Zm-7-2a2 2 0 1 1 4 0v2h-4V6Zm7 14H7V10h10v10Z"/>
              </svg>
              Login
            </span>
          </button>
        </div>

        <div class="or-line"><span>hoáº·c</span></div>

        <div class="auth-btn-row">
          <button id="btnTgRegister" class="ticket-submit-btn">ğŸ§© Register by Telegram</button>
        </div>

        <!-- Telegram Widget -->
        <div id="tgWidgetPanel" class="tg-widget-panel">
          <div class="tg-widget-title">âœ… ÄÄƒng kÃ½ báº±ng Telegram</div>
          <div id="tgWidgetWrap"></div>
        </div>

        <!-- Set password -->
        <div id="setPwPanel" class="pw-panel">
          <div class="pw-title">ğŸ”‘ Äáº·t máº­t kháº©u</div>
          <input id="setPwInput" type="password" placeholder="Máº­t kháº©u (tá»‘i thiá»ƒu 4 kÃ½ tá»±)">
          <button id="btnSetPwSubmit" class="ticket-submit-btn btn-confirm">âœ… LÆ°u máº­t kháº©u</button>
        </div>
      </div>

      <!-- ===== LOGGED IN ===== -->
      <div id="authStateLoggedIn" class="auth-logged-in" style="display:none;">
        <div class="profile-info">
          <div><b>Telegram ID:</b> <span id="uTgId">--</span></div>
          <div><b>Full name:</b> <span id="uFullName">--</span></div>
          <div><b>Äiá»ƒm:</b> <span id="uPoints">0</span></div>
          <div><b>Äiá»ƒm danh hÃ´m nay:</b> <span id="uClaimedToday">--</span></div>
        </div>

        <button id="btnClaimDaily" class="ticket-submit-btn btn-claim">
          âœ… Äiá»ƒm danh nháº­n +1 Ä‘iá»ƒm
        </button>

        <button id="btnLogout" class="ticket-submit-btn btn-logout">
          ğŸšª Logout
        </button>
      </div>
    </div>
  </div>



  <!-- ============================
       ğŸ§© GIAO DIá»†N Káº¾T QUáº¢ Xá»” Sá» - VER 1
    ============================ -->
  <div id="page-lottery" class="page">
    <!-- Calendar popup -->
    <div class="calendar-popup" id="calendarPopup">
      <div class="calendar-header">
        <button id="prevMonth">â—€</button>
        <span id="monthLabel">ThÃ¡ng 11 / 2025</span>
        <button id="nextMonth">â–¶</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <!-- Äiá»u khiá»ƒn ngÃ y -->
    <div class="date-controls">
      <button class="nav-btn" id="prevBtn">â—€ TrÆ°á»›c</button>
      <div class="date-display" id="dateLabel">--/--/----</div>
      <button class="nav-btn" id="nextBtn">Sau â–¶</button>
    </div>

    <!-- Chá»n Miá»n / ÄÃ i -->
    <div class="region-controls" style="display:flex;gap:6px;padding:8px 10px;background:#fff;border-bottom:1px solid #e0e6ef;">
      <select id="regionSelect" style="flex:1;padding:6px;border-radius:6px;border:1px solid #ccc;font-weight:600;">
        <option value="bac">Miá»n Báº¯c</option>
        <option value="trung">Miá»n Trung</option>
        <option value="nam">Miá»n Nam</option>
      </select>

      <select id="stationSelect" style="flex:2;padding:6px;border-radius:6px;border:1px solid #ccc;font-weight:600;">
        <!-- JS Ä‘á»• danh sÃ¡ch Ä‘Ã i -->
      </select>
    </div>

    <!-- Báº£ng káº¿t quáº£ -->
    <div class="card">
      <div class="kq-head" id="regionLabel">XSMB - HÃ  Ná»™i</div>

      <div id="mainResults">
        <div class="row"><div class="cell-left">ÄB</div><div class="cell-right"><div class="db-number" id="dbNumber">--</div></div></div>
        <div class="row"><div class="cell-left">G1</div><div class="cell-right"><div class="g1-number" id="g1Number">--</div></div></div>
        <div class="row"><div class="cell-left">G2</div><div class="cell-right multi-numbs" id="g2"></div></div>
        <div class="row"><div class="cell-left">G3</div><div class="cell-right multi-numbs" id="g3"></div></div>
        <div class="row"><div class="cell-left">G4</div><div class="cell-right multi-numbs" id="g4"></div></div>
        <div class="row"><div class="cell-left">G5</div><div class="cell-right multi-numbs" id="g5"></div></div>
        <div class="row"><div class="cell-left">G6</div><div class="cell-right multi-numbs" id="g6"></div></div>
        <div class="row"><div class="cell-left">G7</div><div class="cell-right g7" id="g7"></div></div>
        <div class="row" id="g8-row" style="display:none;"><div class="cell-left">G8</div><div class="cell-right multi-numbs" id="g8"></div></div>

        <div class="ctrl-bar">
          <div class="mode-btns">
            <button id="mode-all" class="active">All</button>
            <button id="mode-2">2 Sá»‘</button>
            <button id="mode-3">3 Sá»‘</button>
          </div>
          <button id="speakBtn">ğŸ”Š Äá»c káº¿t quáº£</button>
        </div>

        <div class="loto-wrap">
          <div class="loto-title">LÃ´ tÃ´ Äáº§u â€“ ÄuÃ´i</div>
          <div class="loto-grid">
            <div class="loto-col">
              <div class="loto-header"><div>Äáº§u</div><div>ÄuÃ´i</div></div>
              <div id="loto-left"></div>
            </div>
            <div class="loto-col">
              <div class="loto-header"><div>Äáº§u</div><div>ÄuÃ´i</div></div>
              <div id="loto-right"></div>
            </div>
          </div>
          <div class="hint">Vuá»‘t trÃ¡i hoáº·c pháº£i Ä‘á»ƒ Ä‘á»•i ngÃ y</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==============================
  ğŸŸï¸ QUáº¢N LÃ VÃ‰ ÄÃƒ MUA â€” VER 2
  ============================== -->
  <div id="page-tickets" class="page">
    <div class="ticket-box">

    <div class="ticket-inputs">

      <div class="row-two">
        <div class="ticket-number-group">
          <input id="ticketInput" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="Nháº­p VÃ© Sá»‘">
        </div>

        <input id="ticketDate" type="date" class="date-input" lang="vi">
      </div>

      <div class="row-two">
        <select id="ticketStation" ></select>
        <select id="ticketRegion">
          <option value="bac">M.Báº¯c</option>
          <option value="trung">M.Trung</option>
          <option value="nam">M.Nam</option>
        </select>
      </div>

      <button id="saveTicketBtn" class="ticket-submit-btn">
        ğŸ” LÃªn lá»‹ch / Tra cá»©u KQXS
      </button>

    </div>
      <div id="savedTickets" class="ticket-list"></div>
    </div>
  </div>

    <!-- ==============================
  ğŸ¥ Trá»±c tiáº¿p KQXS (Äang phÃ¡t triá»ƒn)
  ============================== -->
  <div id="page-lives" class="page">
    <div id="liveLoader" style="text-align:center; padding:20px;">
      <div style="font-size:40px;">ğŸ”„</div>
      <div style="font-size:18px;">TÃ­nh nÄƒng Ä‘ang phÃ¡t triá»ƒn...</div>
    </div>

    <div id="loadingCubes" class="cubes-loader" style="display:none;">
      <div class="container">
        <div class="cube"></div>
        <div class="cube"></div>
        <div class="cube"></div>
        <div class="cube"></div>
        <div class="cube"></div>
      </div>
    </div>
  </div>


  <!-- Toast mini hiá»ƒn thá»‹ trong giao diá»‡n -->
  <div id="toast"></div>
</div>

<!-- ============================
     ğŸ§  JavaScript chÃ­nh
============================= -->
<script src="js/ver4_lives.js"></script>
<script src="js/ver1_lottery.js"></script>
<script src="js/ver2_tickets.js"></script>
<script src="js/ver3_menu.js"></script>
<script src="js/utils_toast.js"></script>
<script src="js/ver5_auth.js"></script>


<script>
  // function callUnity(type, payload={}) {
  //   const msg = JSON.stringify({ type, id: Date.now().toString(), payload });
  //   if (window.Unity && window.Unity.call) {
  //     window.Unity.call(msg); // Android (UniWebView)
  //   } else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.unityControl) {
  //     window.webkit.messageHandlers.unityControl.postMessage(msg); // iOS
  //   }
  // }

  // document.getElementById("testNotifyBtn").addEventListener("click", () => {
  //   console.log("ğŸ”” Gá»i Unity gá»­i thÃ´ng bÃ¡o test...");
  //   callUnity('OPEN_POPUP', { 
  //     title: 'ThÃ´ng bÃ¡o Test ğŸ¯', 
  //     message: 'NÃºt Test Notification Ä‘Ã£ Ä‘Æ°á»£c báº¥m!' 
  //   });
  // });
  // Khi Unity gá»­i FCM token xuá»‘ng HTML
  window.onReceiveToken = function(token) {
    console.log("ğŸ“± HTML nháº­n token:", token);

    // âœ… LÆ°u token vÃ o biáº¿n toÃ n cá»¥c
    window.fcmToken = token;

    // âœ… LÆ°u token vÃ o localStorage (Ä‘á»ƒ giá»¯ láº¡i sau khi reload)
    localStorage.setItem("fcm_token", token);
  };

  // âœ… Náº¿u Ä‘Ã£ cÃ³ token trong localStorage (app reload), phá»¥c há»“i láº¡i
  window.addEventListener("DOMContentLoaded", () => {
    const savedToken = localStorage.getItem("fcm_token");
    if (savedToken) {
      window.fcmToken = savedToken;
      console.log("ğŸ“¦ KhÃ´i phá»¥c token tá»« localStorage:", savedToken);
      const el = document.getElementById("fcmToken");
      if (el) el.innerText = "FCM Token: " + savedToken;
    }
  });
</script>
 
</body>
</html>
